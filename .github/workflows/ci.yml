name: CI

on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [main]
  pull_request:
    branches: [main]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  tests:
    name: Tests
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE so job can access it
      - uses: actions/checkout@v2

      - name: Setup bot git information
        run: |
          git config user.email "github-action-bot@example.com"
          git config user.name "github-action-bot"

      - name: Switch branch
        run: git checkout -b "bot/new-branch"

      - name: Create change
        run: touch newfile

      - name: Commit change
        run: git commit -am "bot change"

      - name: Push branch
        run: git push --set-upstream origin bot/new-branch

      - name: Create PR
        run: |
          curl \
            -X POST \
            -H 'Accept: application/vnd.github.v3+json' \
            -H 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
            -d '{"title": "Test PR -- ignore", "head": "bot/new-branch", "base", "jaburnsi/test-github-action-push", "body", "This is just a test PR -- ignore and do not complete."}' \
            https://api.github.com/repos/Azure/communication-ui-sdk/pulls/

      - name: Approve PR
        run: |
          curl \
            -X POST \
            -H 'Accept: application/vnd.github.v3+json' \
            -H 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
            -d '{"event": "APPROVE"}' \
            https://api.github.com/repos/Azure/communication-ui-sdk/pulls/49/reviews
