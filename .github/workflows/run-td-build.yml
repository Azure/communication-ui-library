name: Run TD build

on:
  # Postsubmit CI on main.
  push:
    branches: [localization/*]
  # Presubmit CI on PRs to all branches.
  pull_request:
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  checkForChanges:
    - name: Extract branch name
      id: extract_branch
      run: |
        echo "##[set-output name=branch;]$(echo ${GITHUB_REF#refs/heads/})"

    - name: Trigger touchdown build pipeline
      uses: ./.github/workflows/azure-pipeline-action-fork
      with:
        azure-devops-project-url: 'https://skype.visualstudio.com/SCC'
        azure-pipeline-name: 'Azure.communication-ui-library-touchdown-build-components'
        azure-devops-token: '${{ secrets.AZURE_TOUCHDOWN_BUILD_PIPELINE_SECRET }}'
        azure-pipeline-variables: '{"bot_token": "${{ secrets.GITHUB_TOKEN }}", "branch": "${{ steps.extract_branch.outputs.branch }}"}'
