import { Meta } from '@storybook/addon-docs';

<Meta
  id="try-with-vanilla-js"
  title="Composites/Try with VanillaJS"
  parameters={{ previewTabs: { canvas: { disable: true, hidden: true } } }}
/>

# Try Call and Chat Composites with vanilla javascript

Investing in a full React Application to try out the UI Library can be challenging. To help out some of our developers we have bundled the UI Library
as a set of javascript bundles. This will allow developers to try out the UI Library with just a `<script>` tag and few lines of code.

Why you want to try out the composites via CDN experience:

- Great for early prototyping
- Ability to jump into a call/chat thread with minimal engineering investment
- Don't need to complicate your engineering environment with React and Webpack

Why you want to use our React offerings for production workloads:

- Ability to apply performance optimizations (e.g tree-shaking)
- In-depth visual customization and theming
- Leverage modern engineering tooling with capabilities such as type-checking

_We suggest if you would like to continue to use this method of using the UI Library to host the bundled script experience in your own CDN (Content Delivery Networks)_

## Using Composites in your index.html

The first step is to add a script tag:

```html
<!-- ChatComposite -->
<script src="https://github.com/Azure/communication-ui-library/releases/latest/download/chatComposite.js"></script>
```

```html
<!-- CallComposite -->
<script src="https://github.com/Azure/communication-ui-library/releases/latest/download/callComposite.js"></script>
```

```html
<!-- CallWithChatComposite -->
<script src="https://github.com/Azure/communication-ui-library/releases/latest/download/callWithChatComposite.js"></script>
```

You will be able to load load composites using `chatComposite.loadChatComposite` and `callComposite.loadCallComposite`.

We use a pattern where we specify important arguments to launch the experience, followed by the DOM element to apply the UI into, followed by any additional properties.

### Loading the Chat Composite

We start with our necessary arguments (displayName, threadId, endpoint, userId, token) followed by the html element that will contain our chat composite, and the
any additional properties for the composite.

```js
// `chatComposite.loadChatComposite` function is exposed to window object once you import composite bundle.
// The adapter returned allows you control composite externally.
const chatAdapter = await chatComposite.loadChatComposite(
  {
    displayName: 'DISPLAY_NAME', /* string */
    userId: { communicationUserId: 'UserID' /* string */ },
    token: 'TOKEN' /* string */
    threadId: 'THREAD_ID', /* string */
    endpoint: 'ENDPOINT', /* string */
  },
  containerElement, /* string. html container element */
  props /* Optional. Object contains all optional props for composite, check composite page for more details. */
);
```

_Check [Chat Composite Basic Example](./?path=/docs/composites-chat-basicexample--basic-example) for details on what additional properties you can apply to the chat composite_

### Loading the Call Composite

We start with our necessary arguments (displayName, userId, token, locator) followed by the html element that will contain our call composite, and the
any additional properties for the composite.

```js
// `callComposite.loadCallComposite` function is exposed to the window object once you import composite bundle.
// The adapter returned allows you control composite externally.
const callAdapter = await callComposite.loadCallComposite(
  {
    displayName: 'DISPLAY_NAME' /*string */,
    userId: { communicationUserId: 'UserID' /*string */ },
    token: 'ACCCESS_TOKEN' /*string */
    locator: { groupId: 'GROUP_ID' /*string */ }, // If you are joining a Teams meeting, instead of groupId use meetingLink: `locator: { meetingLink: 'MEETING_LINK' /* string */ }`
  },
  containerElement, /* string. html container element */
  props /* Optional. Object contains all optional props for composite, check composite page for more details. */
);
```

_Check [Call Composite Basic Example](./?path=/docs/composites-call-basicexample--basic-example) for details on what additional properties you can apply to the call composite_

### Loading the Call with Chat Composite

We start with our necessary arguments (displayName, userId, token, endpoint, locator) followed by the html element that will contain our call composite, and the
any additional properties for the composite.

```js
// `callWithChatComposite.loadCallWithChatComposite` function is exposed to the window object once you import composite bundle.
// The adapter returned allows you control composite externally.
const callWithChatAdapter = await callWithChatComposite.loadCallWithChatComposite(
  {
    displayName: 'DISPLAY_NAME', /* string */
    userId: { communicationUserId: 'UserID' /* string */ },
    token: 'ACCCESS_TOKEN' /* string */
    endpoint: 'ENDPOINT', /* string */
    locator: { callLocator: { groupId: groupId /* string */ }, chatThreadId: threadId /* string */ } /* callWithChat-specific locator */
  },
  containerElement, /* string. html container element */
  props /* Optional. Object contains all optional props for composite, check composite page for more details. */
);
```

## Examples

Now we can take a look at how this all comes together.

### Chat example

`index.html`

```html
<meta charset="utf-8" />
<!-- Replace this url with your own CDN in production environment -->
<script src="https://github.com/Azure/communication-ui-library/releases/latest/download/chatComposite.js"></script>
<!-- height need to be set for composite to fit the layout -->
<div id="chat-container" style="height: 50vh"></div>
<script type="module">
  const chatAdapter = await chatComposite.loadChatComposite(
    {
      displayName: 'DISPLAY_NAME',
      userId: { communicationUserId: 'UserID' },
      token: 'TOKEN',
      threadId: 'THREAD_ID',
      endpoint: 'ENDPOINT'
    },
    document.getElementById('chat-container'),
    { key: new Date() }
  );
</script>
```

### Calling example

`index.html`

```html
<meta charset="utf-8" />
<!-- Replace this url with your own CDN in production environment -->
<script src="https://github.com/Azure/communication-ui-library/releases/latest/download/callComposite.js"></script>
<!-- height need to be set for composite to fit the layout -->
<div id="call-container" style="height: 50vh"></div>
<script type="module">
  const callAdapter = await callComposite.loadCallComposite(
    {
      displayName: 'DISPLAY_NAME',
      userId: 'USERID',
      token: 'ACCCESS_TOKEN',
      locator: { groupId: 'GROUPID' }
    },
    document.getElementById('call-container'),
    { key: new Date() }
  );
</script>
```

These examples are also available on [Github](https://github.com/Azure/communication-ui-library/blob/main/samples/StaticHtmlComposites/index.html).

❗ If you are getting a syntax error at runtime. Don't forget to add the **`<meta charset="utf-8">`** tag in the header of your html code.
Learn more about the [meta tag](https://developer.mozilla.org/en-US/docs/Learn/HTML/Introduction_to_HTML/The_head_metadata_in_HTML#specifying_your_documents_character_encoding).

❗ If you having issues running the Call Composite on your index.html. It is because the underlying Calling SDK is checking to see if its from localhost or https traffic.
We recommend deploying the index.html with your CallComposite changes onto a local server or to deploy it to an Azure App Service which will serve up the content as https.

# Build your own composite js bundle files

### git clone our repo

```bash
git clone https://github.com/Azure/communication-ui-library.git
```

### Install rush

For this example, we use [rush](https://rushjs.io/) to create the bundles.

```bash

npm install -g @microsoft/rush

```

### Install packages and build js bundles

```bash
cd communication-ui-library/samples/StaticHtmlComposites
rush install
rush build
```

Then you will be able to see 2 js bundle files:

```
./samples/StaticHtmlComposites/dist/chatComposite.js
./samples/StaticHtmlComposites/dist/callComposite.js
./samples/StaticHtmlComposites/dist/callWithChatComposite.js
```

There is also an example html for how to use it, you might want to allocate your own acs token before you embed the code piece to your own web app, check [Create and manage Communication Services resources](https://docs.microsoft.com/azure/communication-services/quickstarts/create-communication-resource?tabs=windows&pivots=platform-azp):

```
./samples/StaticHtmlComposites/index.html
```

### Try it the sample

After finishing building the bundle, you can also try the sample

1. Replace the `ResourceConnectionString` in the `samples/Server/appsettings.json` file with the connection string from your Azure Communication Services resource, which is listed in the Azure Portal under _Keys_.

2. Replace the `EndpointUrl` in the `samples/Server/appsettings.json` file with the endpoint from your Azure Communication Services resource, which is listed in the Azure Portal under _Keys_.

3. Replace the `AdminUserId` in the `samples/Server/appsettings.json` file with a user id minted with the above used Azure Communication Services resource.

4. Run this command to start the server:

```bash
rushx start
```

4. Browse to http://localhost:3000
