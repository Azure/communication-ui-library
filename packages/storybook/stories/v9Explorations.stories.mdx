import { Meta } from '@storybook/addon-docs';
import {
  lightTheme,
  FluentThemeProvider,
  ControlBarButton,
  ControlBarButtonV9,
  ControlBarSplitButtonV9,
  CameraButton,
  ParticipantList,
  ParticipantItem,
  ParticipantItemV9,
  VideoGallery
} from '@internal/react-components';
import { initializeIcons, getTheme, PersonaPresence, Stack, ContextualMenuItemType } from '@fluentui/react';
import {
  VideoOff20Filled,
  Airplane20Filled,
  VehicleShip20Filled,
  Video20Filled,
  VideoBackgroundEffect20Regular
} from '@fluentui/react-icons';
import { FluentProvider, webLightTheme } from '@fluentui/react-components';

<Meta
  id="v9exploration"
  title="Fluent v9 Exploration"
  parameters={{ previewTabs: { canvas: { disable: true, hidden: true } } }}
/>

# Fluent v9 Exploration

## Component Mapping

| v8                                              | v9                                                                                                                                      | Usage                                                                                                                                      |
| ----------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| AnimationStyles                                 | ⚠️ **No v9 equivalent** (Not blocking: can grab CSS directly instead)                                                                   | Drawer (SlideUp), MutedNotification (FadeIn & FadeOut)                                                                                     |
| CalloutProps                                    | Popover                                                                                                                                 | PreventDismissOnEvent                                                                                                                      |
| Chat                                            | Chat (`@fluentui/contrib`)                                                                                                              | MessageThread                                                                                                                              |
| CommandBarButton                                | MenuButton                                                                                                                              | Close side pane button                                                                                                                     |
| concatStyleSets / mergeStyle / \*IStyle         | makeStyles, useStyles, mergeClassNames                                                                                                  | Various                                                                                                                                    |
| DefaultButton & PrimaryButton                   | Button and MenuButton                                                                                                                   | CallControls, Invite button, Close side pane, Dialpad, Overflow Gallery Navigation, Call Readiness modals, Captions Settings, Start Button |
| Drawer (Bottom Sheet)                           | No v8 or v9 component                                                                                                                   | Device Selection, Captions settings, Invite button                                                                                         |
| Dropdown                                        | Dropdown                                                                                                                                | Device Selection, Captions settings, Invite button                                                                                         |
| FocusTrapZone                                   | [Focus Indicator](https://react.fluentui.dev/?path=/docs/concepts-developer-accessibility-focus-indicator--page) ⚠️ **Needs evaluated** | Drawer, Config SidePanel                                                                                                                   |
| FocusZone                                       | [Focus Indicator](https://react.fluentui.dev/?path=/docs/concepts-developer-accessibility-focus-indicator--page) ⚠️ **Needs evaluated** | Captions, Dialpad, ParticipantList                                                                                                         |
| FontIcon                                        | Use `react-icons` directly. IconProvider needs created.                                                                                 | Various                                                                                                                                    |
| getFileTypeIconProps                            | ⚠️ **No v9 equivalent** (TODO: Test if we can still use this as it exists outside of v8 and v9)                                         | FileCard                                                                                                                                   |
| Icon                                            | Use `react-icons` directly. IconProvider needs created.                                                                                 | Various                                                                                                                                    |
| IconButton                                      | Button                                                                                                                                  | Various                                                                                                                                    |
| Label                                           | Label                                                                                                                                   | Various                                                                                                                                    |
| Layer                                           | Portal                                                                                                                                  | FloatingPip, Pipip, Drawer                                                                                                                 |
| Link                                            | Link                                                                                                                                    | CallReadiness modals, Chat Messages                                                                                                        |
| menuProps / ContextualMenu / ContextualMenuItem | MenuButton / MenuList / MenuItem                                                                                                        | VideoTileContextMenu, DevicesButton, SplitButtons InviteButton, MoreButton                                                                 |
| MessageBar                                      | ⚠️ **No v9 equivalent** - [Alert](https://react.fluentui.dev/?path=/docs/preview-components-alert--default) is close but in development | ErrorBar, TroubleshootingGuideErrorBar, FileDownloadErrorBar, VideoEffectsError, SendBox                                                   |
| Modal & IDragOptions                            | ⚠️ **No v9 equivalent found** [feature request](https://github.com/microsoft/fluentui/issues/28359)                                     | CallReadiness, Captions Settings, PiPiP, LocalVideoTile, Dialpad                                                                           |
| Panel                                           | ⚠️ [Drawer](https://react.fluentui.dev/?path=/docs/preview-components-drawer--default) is in development                                | Config Page Video Effects                                                                                                                  |
| Persona, PersonaPresence, PersonaSize           | Persona and Avatar                                                                                                                      | Captions, Video Tiles, Participant Items, Chat Messages                                                                                    |
| ProgressIndicator                               | ProgressBar                                                                                                                             | FileCard                                                                                                                                   |
| Ref                                             | Just use `div`                                                                                                                          | Various                                                                                                                                    |
| Spinner                                         | Spinner                                                                                                                                 | Captions, FileDownloadCard, VideoTile, TransferPage, LobbyPage                                                                             |
| Stack / Flex                                    | [_shim_](https://react.fluentui.dev/?path=/docs/concepts-migration-from-v8-components-flex-stack--page)                                 | Various                                                                                                                                    |
| Stack.Item                                      | [_shim_](https://react.fluentui.dev/?path=/docs/concepts-migration-from-v8-components-flex-stack-item--page)                            | Various                                                                                                                                    |
| Text                                            | Text                                                                                                                                    | Various                                                                                                                                    |
| TextField                                       | Input                                                                                                                                   | SendBox, Edit chat message, Dialpad                                                                                                        |
| ThemeProvider / Provider                        | FluentProvider                                                                                                                          | FluentThemeProvider                                                                                                                        |
| TooltipHost                                     | Tooltip                                                                                                                                 | ControlButtons, Send/complete edit buttons, Message status indicator, VideoEffectsItem                                                     |
| useId                                           | useId (`@fluentui/react-utilities`)                                                                                                     | Various                                                                                                                                    |
| useTheme                                        | token                                                                                                                                   | Various                                                                                                                                    |
| useWarnings                                     | ⚠️ **No v9 equivalent** (only used once, can be easily removed or replaced)                                                             | BackgroundEffects Picker                                                                                                                   |

### UI Library components to migrate

##### Public Components

| Component              | Migration Notes |
| ---------------------- | --------------- |
| VideoTile              |                 |
| VideoGallery           |                 |
| GridLayout             |                 |
| ControlBar             |                 |
| CameraButton           |                 |
| DefaultButton          |                 |
| DevicesButton          |                 |
| EndCallButton          |                 |
| MicrophoneButton       |                 |
| ParticipantsButton     |                 |
| ScreenShareButton      |                 |
| MessageThread          |                 |
| SendBox                |                 |
| MessageStatusIndicator |                 |
| Typing Indicator       |                 |
| ParticipantItem        |                 |
| ParticipantList        |                 |
| Dialpad                |                 |
| ErrorBar               |                 |
| SitePermissions        |                 |
| StreamMedia            |                 |
| UnsupportedBrowser     |                 |

##### Internal Components

| Component                                  | Migration Notes |
| ------------------------------------------ | --------------- |
| ChatMessage                                |                 |
| ChatMessageActions                         |                 |
| ChatMessageEditting                        |                 |
| ChatMentionFlyout                          |                 |
| ChatMentionTextField                       |                 |
| Compliance Banner                          |                 |
| Bottom Sheet / Drawer                      |                 |
| File Card (Card, Groups, Upload, Download) |                 |
| Hold Button                                |                 |
| LocalVideoCameraButton                     |                 |
| PictureInPictureInPicture                  |                 |
| Video Effects Picker                       |                 |
| CallWithChatComposite Chat Button          |                 |
| CallComposite CallPage                     |                 |
| CallComposite ConfigurationPage            |                 |
| CallComposite HoldPage                     |                 |
| CallComposite LobbyPage                    |                 |
| CallComposite NoticePage                   |                 |
| CallComposite TransferPage                 |                 |
| CallComposite UnsupportedBrowser           |                 |
| ChatComposite file upload button           |                 |
| ChatComposite ChatScreen                   |                 |
| ChatComposite file download errors         |                 |

##### Public Samples

| Component              | Migration Notes |
| ---------------------- | --------------- |
| Device Settings        |                 |
| Local Preview Controls |                 |
| Applying Teams Theme   |                 |
| Compliance Banner      |                 |
| Lobby Page             |                 |
| Inline Chat Images     |                 |
| Incomging Call Modal   |                 |
| Incoming Call Toast    |                 |

## v8 to v9 comparison

### Apply theming

Almost no difference here:

```tsx
/// v8
<ThemeProvider theme={myTheme}>
  <ControlBarButton />
</ThemeProvider>

/// v9
<FluentProvider theme={myTheme}>
  <ControlBarButton />
</FluentProvider>
```

When developing, instead of `useTheme()` hook, fluent exposes `tokens`:

```tsx
/// v8
const styles = {
  background: useTheme().palette.neutralQuaternaryAlt
};

/// v9
const styles = {
  background: tokens.colorNeutralForeground4
};
```

and as styles are computed at _build time_, do not use variables inside styles:

```tsx
/// v8
const styles = { background: isActive ? 'red' : 'blue' };

/// v9
const activeStyles = makeStyles({ background: 'red' });
const inactiveStyles = makeStyles({ background: 'blue' });
const className = isActive ? activeStyles : inactiveStyles;
```

### Localization

Currently we expose a LocalizationProvider that wraps the entire app, no need to change this.

```tsx
/// Localization in both v8 and v9
<LocalizationProvider locale={locale}>
  <App />
</LocalizationProvider>
```

### Overriding renders

Overriding renders is much the same. Instead of an onRender callback we instead expose a `slot`:

```tsx
/// v8
<ControlBarButton onRenderIcon={() => <MyIcon />} />

/// v9
<ControlBarButton icon={<MyIcon />} />
```

### Icon Provider

Currently in v8 we use `registerIcons` then refer to icons by name. This does not exist in v9 and instead we will create a provider:

```tsx
/// v8
registerIcons({ icons: { 'my-icon': <MyIcon /> } });
<ControlBarButton iconProps={{ iconName: 'my-icon' }} />;

/// v9
<IconProvider icons={{ 'my-icon': <MyIcon /> }}>
  <ControlBarButton icon={icons['my-icon']} />
</IconProvider>;
```

### Styling nested components

To style the icon in v9, we can no longer just style the nested component and leave the remainder unchanged.
Instead a developer must pass in the appropriate slotted component and apply styles to that slotted component:

```tsx
/// v8 - simply set the style of the icon via an exposed icon styles prop:
<ControlBarButton styles={{ icon: { background: 'red' } }} />;

/// v9 - override the icon slot and pass styles to the icon:
const styles = makeStyles({ icon: { background: 'red' } });
<ControlBarButton icon={<MyIcon className={styles.icon} />} />;
```

~~The implication of this being, **we must export every component we want to be customizable**. You can see the impact of this in a breakdown in VideoGallery example later.~~ **tbd**

## Component Analysis

### ParticipantList Analysis

<table>
  <tr>
    <td></td>
    <td>
      <b>v8</b>
    </td>
    <td>
      <b>v9</b>
    </td>
  </tr>
  <tr>
    <td>ParticipantItem</td>
    <td>
      <div style={{ width: '200px' }}>
        <FluentThemeProvider theme={lightTheme}>
          <ParticipantItem
            displayName="Ivo Graham"
            menuItems={[
              {
                key: 'Mute',
                text: 'Mute',
                onClick: () => alert('Mute')
              },
              {
                key: 'Remove',
                text: 'Remove',
                onClick: () => alert('Remove')
              }
            ]}
            presence={PersonaPresence.online}
          />
        </FluentThemeProvider>
      </div>
    </td>
    <td>
      <div style={{ width: '200px' }}>
        <FluentProvider theme={webLightTheme}>
          <ParticipantItemV9
            displayName="Ivo Graham"
            menuItems={[
              {
                key: 'Mute',
                text: 'Mute',
                onClick: () => alert('Mute')
              },
              {
                key: 'Remove',
                text: 'Remove',
                onClick: () => alert('Remove')
              }
            ]}
          />
        </FluentProvider>
      </div>
    </td>
  </tr>
  <tr>
    <td>ParticipantList</td>
    <td>
      <ParticipantList
        onFetchParticipantMenuItems={(_pId, _uId, defaults) => [
          { key: 'Mute', text: 'Mute', onClick: () => alert('Mute') },
          ...defaults
        ]}
        onRemoveParticipant={() => {}}
        participants={[
          {
            userId: 'user 1',
            displayName: 'You',
            isScreenSharing: true
          },
          {
            userId: 'user 2',
            displayName: 'Hal Jordan',
            isRemovable: true,
            isMuted: true,
            isScreenSharing: true,
            isSpeaking: true
          },
          {
            userId: 'user 3',
            displayName: 'Barry Allen',
            isRemovable: true
          },
          {
            userId: 'user 4',
            displayName: 'Bruce Wayne',
            isRemovable: true
          }
        ]}
      />
    </td>
    <td></td>
  </tr>
</table>

#### data-driven (v8) vs component driven (v9)

```tsx
// Data driven
<ParticipantList
  participants={[{
    userId: string,
    displayName: string,
    isScreensharing: boolean,
    isMuted: boolean,
    isSpeaking: boolean,
    isRemovable: boolean,
  }]}
  myUserId={string}
  excludeMe={boolean}
  onFetchParticipantMenuItems={(userId: string, defaultMenuItems) => IContextualMenuItem[]}
  onParticipantClick={(userId: string) => void}
  onRemoveParticipantClick={(userId: string) => void}
  onMuteParticipantClick={(userId: string) => void}
  styles={IParticipantListStyles}
/>

// Developer Usage:
const participantListProps = usePropsFor(ParticipantList);
<ParticipantList {...participantListProps} styles={{ participantItem: { root: { background: 'red'} } }} />
```

```tsx
// Component driven
<ParticipantList>
  {/** participants.map => */}
  <Menu>
    <MenuTrigger>
      <ParticipantListItem
        participantId={string}
        displayName={string}
        // Icons as individual slots or array of icons?
        screensharingIconSlot={slot<Icon>}
        mutedIconSlot={slot<Icon>}
        speakingIconSlot={slot<Icon>}
      />
    </MenuTrigger>
    <MenuPopover>
      <MenuList>
        <ParticipantItemMuteItem onClick={} />
        <ParticipantItemRemoveItem onClick={} />
        <MenuItem>Custom Item...</MenuItem>
      </MenuList>
    </MenuPopover>
  </Menu>

  <ParticipantListMeItem>...</ParticipantListMeItem>
</ParticipantList>
```

```tsx
// Can we do template components? (So in the middle of data and component driven?)
<ParticipantList
  participants={[{
    userId: string,
    displayName: string,
    isScreensharing: boolean,
    isMuted: boolean,
    isSpeaking: boolean,
    isRemovable: boolean,
  }]}
  myUserId={string}
  excludeMe={boolean}

  // Replacing the following with a slot alternative:
  // onFetchParticipantMenuItems={(userId: string, defaultMenuItems) => IContextualMenuItem[]}
  // onParticipantClick={(userId: string) => void}
  // onRemoveParticipantClick={(userId: string) => void}
  // onMuteParticipantClick={(userId: string) => void}
  // styles={IParticipantListStyles}

  root={Slot<>}
  className={"rootStyling"}
  // Render function or just a set of ParticipantItem props similar to persona's avatar?
  participantItemSlot={(participantProps) => (
    <ParticipantListItem
      {...props}
      onParticipantClick={(userId: string) => void}
      className="<per-item-styling>"
      menuItems={[]}
      menuListItemSlot={(menuItemProps) => (
        <MenuItem {...menuItemProps} />
      )}
      menuListSlot={(menuListProps) => (
        <MenuList {...menuListProps} />
      )}
    />
  )}
/>

 // Or render slots as children:
<ParticipantList<Item>
  participants={[{
    userId: string,
    displayName: string,
    isScreensharing: boolean,
    isMuted: boolean,
    isSpeaking: boolean,
    isRemovable: boolean,
  }]}
  myUserId={string}
  excludeMe={boolean}
>
  {(props: {
    userId: string,
    displayName: string,
    isScreensharing: boolean,
    isMuted: boolean,
    isSpeaking: boolean,
    isRemovable: boolean,
    menuItems: ParticipantItemMenu[],
  }) =>
    <ParticipantItem {...props} className="some-styling">
      <ParticipantItemMenuList>
        {(props: MenuItemProps) =>
          <ParticipantListMenuItem {...props} />
        }
      </ParticipantItemMenuList>
    </ParticipantItem>
  }
</ParticipantList>

const props = usePropsFor(ParticipantList);
const a =
  <ParticipantList {...props}>
    {(props: ParticipantItemProps) => (
      <ParticipantItem {...props}>
        {(props: ParticipantItemProps) => (
          <ParticipantItemMenuList {...props}>
            {props.menuItems.map((menuItemProps) => (
              <ParticipantItemMenuItem {...menuItemProps} />
            ))}
            <CUSTOM_MENU_ITEM />
          </ParticipantItemMenuList>
        )}
      </ParticipantItem>
    )}
  </ParticipantList>
```

#### usePropsFor options

### CameraButton Analysis

<table>
  <tr>
    <td></td>
    <td>
      <b>v8</b>
    </td>
    <td>
      <b>v9</b>
    </td>
  </tr>
  <tr>
    <td>CameraButton</td>
    <td>
      <div style={{ width: 'fit-content' }}>
        <FluentThemeProvider theme={lightTheme}>
          <ControlBarButton
            showLabel={true}
            strings={{ label: 'Camera' }}
            onRenderIcon={() => <VideoOff20Filled primaryFill="currentColor" />}
          />
        </FluentThemeProvider>
      </div>
    </td>
    <td>
      <div style={{ width: 'fit-content' }}>
        <FluentProvider theme={webLightTheme}>
          <ControlBarButtonV9
            showLabel={true}
            strings={{ label: 'Camera' }}
            onIcon={<VideoOff20Filled primaryFill="currentColor" />}
            offIcon={<VideoOff20Filled primaryFill="currentColor" />}
          />
        </FluentProvider>
      </div>
    </td>
  </tr>
  <tr>
    <td>CameraButton (split)</td>
    <td>
      <FluentThemeProvider theme={lightTheme}>
        <ControlBarButton
          onClick={() => {}}
          split={true}
          menuProps={{
            items: [
              {
                itemType: ContextualMenuItemType.Section,
                sectionProps: {
                  topDivider: true,
                  bottomDivider: true,
                  title: 'Camera',
                  items: [
                    {
                      text: 'Logitech Brio',
                      subMenuProps: {
                        items: [
                          { key: '1', text: 'Another Mic' },
                          { key: '2', text: 'And another mic' }
                        ]
                      }
                    }
                  ]
                }
              },
              { itemType: ContextualMenuItemType.Divider },
              {
                text: 'Turn on camera',
                iconProps: {},
                onRenderIcon: () => <Video20Filled primaryFill="currentColor" />
              },
              {
                text: 'Effects',
                iconProps: {},
                onRenderIcon: () => <VideoBackgroundEffect20Regular primaryFill="currentColor" />
              }
            ]
          }}
          showLabel={true}
          strings={{ label: 'Turn off' }}
          onRenderIcon={() => <VideoOff20Filled primaryFill="currentColor" />}
          styles={{
            root: {
              border: 'solid 1px ' + getTheme().palette.neutralQuaternaryAlt,
              borderRadius: getTheme().effects.roundedCorner4,
              minHeight: '2.5rem',
              maxWidth: '12rem' // allot extra space than the regular ControlBarButton. This is to give extra room to have the icon beside the text.
            },
            flexContainer: {
              display: 'flex',
              flexFlow: 'row nowrap'
            },
            textContainer: {
              // Override the default so that label doesn't introduce a new block.
              display: 'inline',
              // Ensure width is set to permit child to show ellipsis when there is a label that is too long
              maxWidth: '100%'
            },
            label: {
              fontSize: getTheme().fonts.medium.fontSize,
              // Ensure there is enough space between the icon and text to allow for the unread messages badge in the chat button
              marginLeft: '0.625rem',
              // Ensure letters that go above and below the standard text line like 'g', 'y', 'j' are not clipped
              lineHeight: '1.5rem',
              // Do not allow very long button texts to ruin the control bar experience, instead ensure long text is truncated and shows ellipsis
              display: 'block',
              textOverflow: 'ellipsis',
              whiteSpace: 'nowrap',
              overflow: 'hidden'
            },
            splitButtonMenuButton: {
              border: 'solid 1px ' + getTheme().palette.neutralQuaternaryAlt,
              borderTopRightRadius: getTheme().effects.roundedCorner4,
              borderBottomRightRadius: getTheme().effects.roundedCorner4,
              borderTopLeftRadius: '0',
              borderBottomLeftRadius: '0'
            },
            splitButtonMenuButtonChecked: {
              // Default colors the menu half similarly for :hover and when button is checked.
              // To align with how the left-half is styled, override the checked style.
              background: 'none'
            }
          }}
        />
      </FluentThemeProvider>
    </td>
    <td>
      <FluentProvider theme={webLightTheme}>
        <ControlBarSplitButtonV9
          showLabel={true}
          strings={{ label: 'Turn off' }}
          onIcon={<VideoOff20Filled primaryFill="currentColor" />}
          offIcon={<VideoOff20Filled primaryFill="currentColor" />}
        />
      </FluentProvider>
    </td>
  </tr>
</table>

#### Code Difference

```tsx
/// v8 - everything passed in as top level props
<CameraButton
  cameras={[{ id: string; name: string}]}
  selectedCameraId={string}
  onToggleCamera={() => {}}
  onSelectCamera={(id: string) => {}}
  onEffectsClick={() => {}}
  strings={{
    onLabel: string,
    offLabel: string,
    tooltipOnContent: string,
    tooltipOffContent: string,
    tooltipVideoLoadingContent: string,
    effectsMenuItemTitle: string,
    ...
  }}
  styles={{
    root: ...,
    menuStyles: {
      root: ...,
      ...
    }
  }}
/>

/// v9 - everything is slotted in, in fact the button is slotted into the menu:
<Menu positioning="below-end">
  <MenuTrigger>
    {(triggerProps: MenuButtonProps) => (
      <CameraButton menuButton={triggerProps} onToggleCamera={} icon={<Video20Filled />} isDisabled={boolean} />
    )}
  </MenuTrigger>

  <MenuPopover>
    <MenuList>
      <CameraListMenu cameras=[] selectedCamera={} onSelectedCameraChange={} />
      <MenuDivider />
      <CameraToggleMenuItem checked={boolean} onCameraToggled={(isChecked) => void} />
      <EffectsMenuItem onClick={} />
    </MenuList>
  </MenuPopover>
</Menu>

/// OR possible something both data driven but with customization exposure:
<CameraButton
  cameras={[{ id: string; name: string}]}
  selectedCameraId={string}
  onToggleCamera={() => {}}
  onSelectCamera={(id: string) => {}}
  onEffectClick={() => {}}
>
  <CameraButtonCameraList>
    ({props: {cameras: Camera[], selectedCameraId: string, onSelectCamera: (id: string) => void} => (
      <CameraListMenu {...props} />
    )})
  </CameraButtonCameraList>
  <CameraButtonToggle>
    ({props: {checked: boolean, onToggle: (isChecked: boolean) => void} => (
      <CameraToggleMenuItem {...props} />
    )})
  </CameraButtonToggle>
  <CameraButtonEffects>
    ({props: {onClick: () => void} => (
      <EffectsMenuItem {...props} />
    )})
  </CameraButtonEffects>
</CameraButton>
```

#### Add custom menu item to the default set

```tsx
/// v8 - use callback that contains defaults:
<ControlBarButton onFetchSplitButtonMenuItems={(defaultMenuItems) => [...defaultMenuItems, customItem]} />

/// v9 - TODO: THIS IS AN OPEN QUESTION
```

#### Connecting to stateful

In v8, we would use usePropsFor to connect to stateful components. In order to do so the components would have the appropriate props exposed that exactly match the usePropsFor interface:

```tsx
/// v8 usePropsFor example
const cameraButtonSelector: CameraButtonSelector = reselect.createSelector(
  [],
  () => {
    ...
    return {
      disabled: !deviceManager.selectedCamera || !permission || !deviceManager.cameras.length,
      checked: localVideoStreams !== undefined && localVideoStreams.length > 0 ? !!localVideoFromCall : previewOn,
      cameras: deviceManager.cameras,
      selectedCamera: deviceManager.selectedCamera
    };
  }
);

const cameraButtonHandlers: CameraButtonHandlers = {
  onToggleCamera: () => { ... }
  onSelectCamera: (camera) => { ... }
};

interface CameraButtonProps {
  disabled: boolean;
  checked: boolean;
  cameras: Camera[];
  selectedCamera: Camera;
  onToggleCamera: () => void;
  onSelectCamera: (camera: Camera) => void;
}

// Notice the return value of the selector matches the interface of the props
```

However in v9, we pass in components instead of data. Therefore, we must expose the components we use with appropriate usePropsFor for each component:

```tsx
/// v9 usePropsFor example
const cameraButtonSelector = reselect.createSelector(
  return {
    disabled: !deviceManager.selectedCamera || !permission || !deviceManager.cameras.length,
    checked: localVideoStreams !== undefined && localVideoStreams.length > 0 ? !!localVideoFromCall : previewOn,
  };
);

const cameraButtonHandlers = {
  onToggleCamera: () => { ... }
};

const cameraSelectionMenuItemSelector = reselect.createSelector(
  return {
    cameras: deviceManager.cameras,
    selectedCamera: deviceManager.selectedCamera
  };
);

const cameraSelectionMenuItemHandlers = {
  onSelectCamera: (camera) => { ... }
};

const cameraSelectionMenuItemHandlers = {
  onSelectCamera: (camera) => { ... }
};

const toggleCameraMenuItemSelector = reselect.createSelector(
  return {
    checked: deviceManager.cameras
  };
);

const toggleCameraMenuItemHandlers = {
  onToggleCamera: () => { ... }
};
```

Comparing the Contoso usage of both:

```tsx
/// v8
const cameraProps = usePropsFor(CameraButton);
<CameraButton {...cameraProps} />;

/// v9
const cameraButtonProps = usePropsFor(CameraButton);
const cameraSelectionMenuItemProps = usePropsFor(CameraSelectionMenu);
const toggleCameraMenuItemProps = usePropsFor(ToggleCameraMenuItem);
<Menu positioning="below-end">
  <MenuTrigger>
    {(triggerProps: MenuButtonProps) => <CameraButton menuButton={triggerProps} {...cameraButtonProps} />}
  </MenuTrigger>

  <MenuPopover>
    <MenuList>
      <CameraSelectionMenuItem {...cameraSelectionMenuProps} />
      <ToggleCameraMenuItem {...toggleCameraMenuItemProps} />
    </MenuList>
  </MenuPopover>
</Menu>;
```

### Video Gallery Analysis

<FluentThemeProvider>
  <div style={{ height: '500px' }}>
    <VideoGallery
      layout="floatingLocalVideo"
      localParticipant={{
        userId: 'user1',
        displayName: 'You',
        state: 'Connected',
        isMuted: true
      }}
      remoteParticipants={[
        {
          userId: 'user2',
          displayName: 'Peter Parker'
        },
        {
          userId: 'user3',
          displayName: 'Thor'
        },
        {
          userId: 'user4',
          displayName: 'Matthew Murdock'
        },
        {
          userId: 'user5',
          displayName: 'Bruce Wayne'
        }
      ]}
    />
  </div>
</FluentThemeProvider>

## Open Questions

- Best way to allow defaults + custom items (e.g. in a split button menu)
- ~~Why does persona's avatar take avatar props instead of an avatar component slot? What goes into this decision?
  [codepen example](https://codesandbox.io/s/bold-blackwell-s7wk98?file=/example.tsx)~~ Is a bug, Persona should work with both, filed one here: [fluentui/issues/28358](https://github.com/microsoft/fluentui/issues/28358)
- No more `registerIcons` - how should we handle customizing icons? (Icon Provider?)
- Will dialog be getting drag functionality - is there a intake form for requests? Or file github issue and go from there?
- Splitbutton touch behavior has changed - filed bug: [fluentui/issues/28357](https://github.com/microsoft/fluentui/issues/28357)
- I see `.` for associating like-components (e.g. Stack and Stack.Item) is not used anymore - any design behind that? (e.g. poor treeshaking?)
- Does fluent have SWAG estimates for migrating 1 component from v8 to v9?
- If babel or webpack doesn't transpile styles ahead of time, do they still work just less optimized? (i.e. what happens if I dont have the webpack plugin or babel translator installed?)
- ~~Is animation for context menus being worked on or is this a design change?~~ Fixed: [fluentui/pull/28119](https://github.com/microsoft/fluentui/pull/28119)

<!--
## Key Takeaways
- Instead of passing data (as top level props), you pass components (via slots)
  - Therefore, instead of exposing data APIs we must expose the components we use
- Instead of nested styles prop, we use className (and styles are built at build time, not interpreted at runtime)
  - Therefore runtime variables _cannot_ be used in styles calculations
- ...
-->
