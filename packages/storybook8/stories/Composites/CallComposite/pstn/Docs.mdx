import { Meta, Source } from '@storybook/addon-docs';
import QuickstartPSTNSnippet from '!!raw-loader!./snippets/QuickstartPSTN.snippet.tsx';

<Meta title="Composites/CallComposite/PSTN/Docs" />

# Getting Started With PSTN

The UI Library CallWithChat Composite and Calling Composite supports PSTN by enabling developers to dial and call phone numbers through
Azure Communication Services call service. The UI Library renders a dialpad that supports DTMF (dual tone multi-frequency) and other
features such as being put on hold and dialing in and removing users from an existing call.

More specifically, the following features are supported:

1. [DTMF](./?path=/docs/components-dialpad--docs#dtmf-mode) (dual tone multi-frequency)
2. [Dialpad UI](./?path=/docs/components-dialpad--docs#dialer-mode)
3. [On/Off hold features](./?path=/docs/composites-adapters--docs)
4. 1 to 1 participant PSTN calls
5. Multi participant PSTN calls
6. Dialing/Adding PSTN participants into an existing call
7. Removing PSTN participants from a call

## Download the Code

We will be modifying the composite quickstarts to enable PSTN calling.
Download the [UI Library quickstart composites](https://github.com/Azure-Samples/communication-services-javascript-quickstarts/tree/main/ui-library-quickstart-composites) to get started.

## Prerequisites

- An Azure account with an active subscription. [Create an account for free](https://azure.microsoft.com/free/?WT.mc_id=A261C142F).
- [Node.js](https://nodejs.org/) Active LTS and Maintenance LTS versions.
- An active Communication Services resource. [Create a Communication Services resource](https://docs.microsoft.com/azure/communication-services/quickstarts/create-communication-resource?tabs=windows&pivots=platform-azp).
- An identity with VoIP scope. Generate an identity using the [Azure Portal](https://docs.microsoft.com/azure/communication-services/quickstarts/identity/quick-create-identity).
- A [phone number](https://docs.microsoft.com/en-us/azure/communication-services/quickstarts/telephony/get-phone-number) created within the active Communication Service resource.

## Download dependencies

Run `npm i` on the directory of the project to install dependencies

## Get and Manage Phone Numbers

For this quickstart, you are required to provide a [phonenumber](https://docs.microsoft.com/en-us/azure/communication-services/quickstarts/telephony/get-phone-number)
known as an alternate caller ID from an Azure Communications resource. This phone number serves as your caller ID when calling PSTN.

You can follow the [quickstart](https://docs.microsoft.com/en-us/azure/communication-services/quickstarts/telephony/get-phone-number) to get phone numbers
for PSTN use.

## Initialize Composite

Go to the `src` folder inside of `ui-library-quickstart-composites` and look for the file `App.tsx`.
Here we'll drop the following code to initialize our Composite Components for PSTN Calling using the call adapter.

The adapter requires an [access token](https://docs.microsoft.com/azure/communication-services/concepts/identity-model#access-tokens),
[alternate caller ID](./?path=/docs/composites-adapters--docs), and phone number(s) for the call to be setup for PSTN.
For this quickstart, the access tokens required need to have `VoIP` scope.

`App.tsx`

<Source code={QuickstartPSTNSnippet} />

## Run Quickstart

To run the code above use the command:

```bash

npm run start

```

Successfully starting the quickstart will call the phone number(s) provided as seen in the image below.
![pstn joining call](images/pstn-quickstart.png)

## Troubleshooting

See the [troubleshooting page](./?path=/docs/concepts-troubleshooting--docs) for some common problems and recommended solutions.
