<!DOCTYPE html>
<head>
  <meta charset="utf-8" />
  <title>Basic example for CallComposite and ChatComposite</title>
</head>
<body>
  <!-- height need to be set for composite to fit the layout -->
  <div id="video-call" style="height: 50vh"></div>
  <div id="chat" style="height: 50vh"></div>
  <script src="./chatComposite.js"></script>
  <script src="./callComposite.js"></script>
  <script src="./service.js"></script>
  <script type="module">
    const { user, token } = await service.createUserWithToken();
    const guid = await service.createGUID();
    // Call composite sample code starts here
    const displayName = 'Bob';

    const callAdapter = await callComposite.loadCallComposite({
      containerId: 'video-call',
      groupId: guid, // Provide any GUID to join a group
      displayName: displayName,
      userId: user,
      token: token
    });

    const threadId = await service.createChatThread();
    await service.addChatUser(threadId, user, displayName);
    const endpointUrl = await service.getEndpointUrl();

    // Chat composite sample code starts here
    const chatAdapter = await chatComposite.loadChatComposite({
      containerId: 'chat',
      displayName: displayName,
      threadId: threadId,
      endpointUrl: endpointUrl,
      userId: user,
      token: token
    });

    await chatAdapter.sendMessage('Hello to you! ðŸ‘‹');

    window.onbeforeunload = () => {
      callAdapter.dispose();
      chatAdapter.dispose();
    };
  </script>
</body>
